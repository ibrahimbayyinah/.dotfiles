#!/bin/sh

# Edited from https://github.com/ericmurphyxyz/dotfiles

# Script to set the wallpaper and lock screen in either Xorg or Wayland
# If no arguments are passed, the wallpaper will be set (e.g. at session start)
# If an image is passed, it will set it as the new wallpaper/lockscreen
# Requires hyprpaper for wayland and xwallpaper and betterlockscreen for Xorg

# location of the current wallpaper - gotten from pywal
# wallpaper_location="$(< $XDG_CACHE_HOME/wal/wal)"


if [ "$theme_choice" == "l" ]; then
    theme=" -l "
else
    theme=""
fi

# location of hyprpaper config file, generated by Pywal
hyprpaper_location="$XDG_CACHE_HOME/wal/hyprpaper.config"

# if image is passed, copy the image to wallpaper_location
if [ $# -gt 0 ]; then
    # check if file passed is an image, return an error otherwise 
    case "$(file --mime-type -b "$1")" in
        image/* )
            printf "Light or dark theme: [l/d] "
            read -n 1 theme_choice
            case "$theme_choice" in
                l) echo -e "\nSetting wallpaper (light theme)..." && wal -q -n -l -i "$1" ;; # invoking pywal
                d) echo -e "\nSetting wallpaper (dark theme)..." && wal -q -n -i "$1" ;;
                *) echo -e "\nInvalid theme choice. Exiting." ; exit 1;;
            esac
            ;;
        *) echo "Not a valid image or directory." ; exit 1;;
    esac

    # update the lockscreen background
    # if [ "$XDG_SESSION_TYPE" = "x11" ]; then
    #     betterlockscreen -u "$wallpaper_location" --fx
    # fi
fi


if [ "$XDG_SESSION_TYPE" = "wayland" ]; then
    # restart hyprpaper
    pkill hyprpaper
    nohup hyprpaper -c "$hyprpaper_location" >/dev/null 2>&1 &
# else 
#     xwallpaper --zoom "$wallpaper_location"
#     betterlockscreen -u "$1" --fx
fi
